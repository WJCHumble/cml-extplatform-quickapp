<template>
  <view>
    <view><text>a: {{a}}</text></view>
    <view><text>computedA: {{computedA}}</text></view>
    <view><text>b: {{b}}</text></view>
    <view><text>login.phone: {{login.phone}}</text></view>
    <view><text>message: {{message}}</text></view>
    <input placeholder="input content" value="{{title}}" c-bind:input="change(1, 'item', false, $event, 'index' + 1234)"></input>
    <com onmyevent="myEvent"></com>
  </view>
</template>

<script>
  import store from '../../store'
  const {
    mapState,
    mapMutations,
    mapActions,
    mapGetters
  } = store

  class Home {
    data = {
      a: 'default a',
      title: '',
      b: ''
    }

    computed = {
      ...mapState(['login']),
      computedA() {
        console.log('##### computed => this.a = ', this.a)
        return 'computed ' + this.a
      },
      // computedB() {
      //   console.log('##### b has been computed')
      //   return this.b
      // },
      message() {
        console.log('##### computed => this.title = ', this.title)
        return 'computed ' + this.title
      }
    }

    watch = {
      login(n, o) {
        console.log('##### Store watched, this.login = ', this.login)
      },
      title() {
        console.log('##### watched, this.title = ', this.title)
      },
      a() {
        console.log('##### watched, this.a = ', this.a)
      },
      b() {
        console.log('####### watched, this.b = ', this.b)
      }
    }
    methods = {
      ...mapMutations(['changeLogin']),
      change(a, b, c, $event) {
        this.title = $event.detail.value
      },
      myEvent() {
        console.log('#### myevent triggered')
      }
    }
    mounted() {
      this.$watch('login', function (v) {
        console.log('##### this.$watch => login ', v)
      })
      this.$watch('title', function (v) {
        console.log('##### this.$watch => title ', v)
      })

      setTimeout(() => {
        console.log('-------- store.login', store.state.login)
        console.log('-------- this.login', this.login)

        this.a = "new a "
        this.b = 'new b'
        this.title = 'new title';

        this.changeLogin({
          phone: '12132'
        })

        console.log('--------- after store.login', store.state.login)
        console.log('--------- after this.login', this.login)

      }, 2000)
    }
  }
  export default new Home();
</script>

<style scoped>

</style>


<script cml-type="json">
  {
    "base": {
      "usingComponents": {
        "com": "../index/index"
      },
      "navigationBarTitleText": "Chameleon Demos",
      "backgroundTextStyle": "dark",
      "backgroundColor": "#F0F2F7"
    }
  }
</script>